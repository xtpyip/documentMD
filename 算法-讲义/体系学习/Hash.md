# Hash

## 基本内容

### hash

- hash函数是一个把长度大的入参数据转化为长度小的出参数据的一个函数方法

- 具有两个性质，**离散性与均匀性**

- 内容：

  > hash的底层是一个数组+链表（树结构）实现的，当查询速度慢了（或者其中一个数组的数据太长，超过范围了），会进行扩容操作，将数组扩充，并使用新的hash函数将原数据进行填充。
  >
  > 例如，当数据达到 2 4 8 16 ... log_2n时会进行数据扩充，扩充的代价则是一个等比数列
  > $$
  > W = a_0*(1-r^n)/(1-r) = 2*{(1-2^k)}/{(1-2)}
  > $$
  > k = log_2n
  > $$
  > W = 2*(1-2^{log_{2}n})/(1-2) = 2*(1-n)/(1-2) = 2*(n-1)
  > $$
  > 因为此时扩充的代价是O(N)，不同的扩充策略会影响常数时间，不会影响复杂度的级别
  >
  > 查询或添加了N个，所以查询的时间复杂度平均是O(N)/N = O(1)

### 布隆过滤器

- 特点

  - 利用哈希函数的性质
  - 每一条数据提取特征
  - 加入描黑库

- 作用

  - 对指定的数据添加黑名单
  - 有误判率（不可避免）(只要是添加过的黑名单，不会误报，只会有一定概率把正确的误报成黑名单)

- 重要公式：

  - **假设数据量为n,预期失误率为p(布隆过滤器大小和样本的大小无关)**

  - 根据n和p,算出布隆过滤器需要的bit位，向上取整记为m

  - 根据m和n,算出布隆过滤器需要多少个哈希函数，向上取整，记为k

  - 根据修正公式，算出真实的失误率p_true

    ![](D:/documentMD/算法-讲义/img/a2020_32_bloom.png)

  - 根据两个不同的hash函数，可以使用2*h1+h2,3h1+h2等构造出多个不相同的hash函数

- 应用

  - hdfs（HDFS（Hadoop Distributed File System）是Hadoop生态系统中的分布式文件系统，用于存储和处理大规模数据集），查找文件
  - url判断（黑名单）

### 一致性哈希

- 分布式存储结构常见的结构 
  - 哈希域变环设计
    - 成环，然后加节点，顺时针的那部分交由另一个节点管理
  - 虚拟节点技术
    - 每个物理空间set管理一个环上的n个节点
    - 添加一个物理空间set,之前的物理空间set管理的节点分给新的set,使所有的set数据量几乎相等